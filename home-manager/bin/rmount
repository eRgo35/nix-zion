#!/usr/bin/env bash
set -euo pipefail

usage() {
  cat <<'USAGE' >&2
Usage: rmount <host>

Mount the remote host's /home/$USER via sshfs to ~/remotes/<name>.
USAGE
  exit 1
}

if [ $# -lt 1 ]; then
  usage
fi

host="$1"
remote="dummy"

case "$host" in
  c2yz.com) remote="c2yz";;
  freya|192.168.200.1) remote="freya";;
  zion|192.168.200.2) remote="zion";;
  thor|192.168.200.3) remote="thor";;
  loki|192.168.200.4) remote="loki";;
  ragnarok|192.168.200.5) remote="ragnarok";;
  home|192.168.0.200) remote="home";;
  *)
    # Fallback: keep only safe filename chars, lower-case
    remote=$(printf '%s' "$host" | tr -cd '[:alnum:]._-' | tr '[:upper:]' '[:lower:]')
    ;;
esac

mountpoint="$HOME/remotes/$remote"

echo "Mounting $host to: $mountpoint"

mkdir -p "$mountpoint"

# Use quotes to preserve any special characters and avoid word-splitting
sshfs -o idmap=user "${USER}@${host}:/home/${USER}" "$mountpoint"